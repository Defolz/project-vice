# VICE Debug Tools - Инструкция по использованию

## Обзор
Комплексный набор инструментов отладки для PROJECT-VICE с поддержкой ECS архитектуры Unity DOTS.

## Установленные инструменты

### 1. VICE Debug Window (Главное окно отладки)
**Путь меню:** `VICE > Debug Window`

Основное окно отладки с 5 вкладками:

#### Overview (Обзор)
- Общее состояние игры и время
- Количество активных Entity, Chunks и NPCs
- Текущий FPS и использование памяти
- Настройка интервала обновления (0.1-2.0 сек)

#### Chunks (Чанки)
- Список всех активных чанков с информацией:
  - ID чанка [X, Y]
  - Состояние (Loaded, Generating, Unloaded, Dirty, Unloading)
  - Количество NPC в чанке
  - Мировые координаты
- Поиск по ID или состоянию
- Сортировка:
  - По ID
  - По состоянию
  - По количеству NPC
- Кнопка "Select" для выбора Entity чанка

#### NPCs (Персонажи)
- Полный список NPC с детальной информацией:
  - Имя (цветная индикация: зеленый = жив, красный = мёртв)
  - ID персонажа
  - Фракция
  - Чанк, в котором находится
  - Статус (Dead, Wanted, Injured, Normal)
- Фильтры:
  - Показать только живых
  - Фильтр по фракции
  - Текстовый поиск по имени/ID
- Сортировка:
  - По ID
  - По имени
  - По фракции
  - По чанку
- Кнопка "Select" для инспекции Entity

#### Performance (Производительность)
- Метрики FPS:
  - Текущий FPS (цветная индикация)
  - Средний FPS за последние 100 кадров
  - Минимальный и максимальный FPS
- График FPS в реальном времени
- Использование памяти:
  - Общая оценка памяти
  - Память чанков
  - Память NPC
- Статистика Entity:
  - Количество чанков
  - Количество NPC
  - Среднее количество NPC на чанк

#### Commands (Команды)
- Спавн NPC (в разработке)
- Очистка всех NPC
- Принудительное обновление чанков

**Настройки:**
- Auto Refresh - автоматическое обновление данных
- Refresh - ручное обновление
- Интервал обновления настраивается на вкладке Overview

---

### 2. Improved Chunk Visualizer (Улучшенный визуализатор чанков)
**Компонент:** Добавьте `ImprovedChunkVisualizer` на любой GameObject в сцене

#### Настройки визуализации:
- **Show Chunk Borders** - показать границы чанков
- **Show Chunk Labels** - показать метки чанков с ID
- **Show NPC Positions** - показать позиции NPC как точки
- **Show NPC Count** - показать количество NPC в метке чанка

#### Фильтры отображения:
- **Show Only Loaded Chunks** - показывать только загруженные чанки
- **Max Chunks To Visualize** - максимум чанков для отрисовки (оптимизация)

#### Цвета состояний:
- Зеленый - Loaded (загружен)
- Желтый - Generating (генерируется)
- Серый - Unloaded (не загружен)
- Красный - Dirty (изменён)
- Пурпурный - Unloading (выгружается)
- Синий - точки NPC

#### Настройки размеров:
- **Border Thickness** - толщина границ чанков
- **NPC Point Size** - размер точек NPC
- **Label Font Size** - размер шрифта меток

#### Производительность:
- **Update Interval** - интервал обновления (0.1-5.0 сек)
  - Меньше = более актуально, но больше нагрузка
  - Больше = меньше нагрузка, но данные могут запаздывать

**Преимущества:**
- Кэшированные данные (обновляются по таймеру, а не каждый кадр)
- Ограничение максимума отрисованных чанков
- Оптимизированная отрисовка через Gizmos
- Цветовая индикация состояний

---

### 3. System Performance Profiler (Профилировщик систем)
**Путь меню:** `VICE > Performance Profiler`

Детальный профайлер производительности ECS систем:

#### Функции:
- Отслеживание времени выполнения каждой системы
- Метрики:
  - **Last** - время последнего обновления
  - **Avg** - среднее время за 60 кадров
  - **Min** - минимальное время
  - **Max** - максимальное время
  - **Graph** - мини-график времени выполнения

#### Сортировка:
- По имени системы
- По среднему времени
- По максимальному времени
- По последнему времени

#### Цветовая индикация:
- Зеленый: < 0.5 ms (отличная производительность)
- Желтый: 0.5-1.0 ms (приемлемая производительность)
- Красный: > 1.0 ms (требует оптимизации)

#### Элементы управления:
- **Auto** - автообновление
- **Clear** - очистить собранные данные
- **Refresh** - обновить вручную

**Примечание:** Для точных измерений требуется интеграция с Unity Profiling API. Текущая версия показывает пример структуры.

---

## Быстрый старт

### Шаг 1: Откройте Debug Window
1. В Unity Editor выберите `VICE > Debug Window`
2. Запустите игру (Play mode)
3. Наблюдайте за данными в реальном времени

### Шаг 2: Настройте визуализацию
1. Создайте пустой GameObject в сцене
2. Добавьте компонент `ImprovedChunkVisualizer`
3. Настройте параметры по вашему вкусу
4. В Scene View вы увидите визуализацию чанков и NPC

### Шаг 3: Мониторинг производительности
1. Откройте `VICE > Performance Profiler`
2. В Play mode наблюдайте за производительностью систем
3. Используйте сортировку для поиска узких мест

---

## Рекомендации по производительности

### Для Debug Window:
- Используйте интервал обновления 0.5-1.0 сек для баланса
- Отключайте Auto Refresh когда окно не активно
- Используйте фильтры для уменьшения количества отображаемых элементов

### Для Chunk Visualizer:
- Установите Max Chunks To Visualize в диапазоне 30-50
- Используйте Show Only Loaded Chunks при большом количестве чанков
- Увеличьте Update Interval до 1-2 сек если FPS падает
- Отключайте компонент когда визуализация не нужна

### Для Performance Profiler:
- Держите окно открытым только при активной отладке
- Обращайте внимание на системы с красной индикацией
- Используйте Clear после оптимизации для новых измерений

---

## Известные ограничения

1. **ViceDebugWindow:**
   - Не работает вне Play mode
   - Команды Spawn/Clear требуют реализации в игровой логике

2. **ImprovedChunkVisualizer:**
   - Gizmos видны только в Scene View
   - При большом количестве объектов может снижать FPS редактора

3. **SystemPerformanceProfiler:**
   - Требует доработки для точных измерений через Unity Profiling API
   - Текущая версия - демонстрационная

---

## Интеграция с существующими инструментами

Новые инструменты дополняют существующие:
- **NPCSceneClickHandler** - клик на NPC в Scene View показывает попап
- **NPCInspector** - детальная информация о NPC в консоли
- **ChunkDebugVisualizer** - можно использовать параллельно, но рекомендуется ImprovedChunkVisualizer

---

## Следующие шаги для улучшения

1. Интегрировать точные замеры производительности через Unity.Profiling API
2. Добавить экспорт данных в CSV/JSON
3. Реализовать команды спавна через события ECS
4. Добавить фильтры по дистанции для визуализации
5. Создать систему сохранения настроек между сессиями
6. Добавить визуализацию путей движения NPC
7. Интегрировать с системой логирования событий

---

## Горячие клавиши

- **ESC** в Scene View - закрыть NPC popup (NPCSceneClickHandler)
- **LMB** на NPC в Scene View - показать информацию о NPC

---

## Поддержка и обратная связь

При обнаружении багов или для предложений по улучшению:
1. Используйте консоль Unity для диагностики
2. Проверьте, что все компоненты правильно добавлены
3. Убедитесь что работаете в Play mode для инструментов реального времени

---

**Версия:** 1.0
**Дата:**
**Проект:** PROJECT-VICE
