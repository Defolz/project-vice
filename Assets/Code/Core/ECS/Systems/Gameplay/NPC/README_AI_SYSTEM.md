# NPC AI Goal System - –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

## üìã –û–±–∑–æ—Ä

–ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç–∞ –¥–ª—è NPC, –æ—Å–Ω–æ–≤–∞–Ω–Ω–∞—è –Ω–∞ —Ü–µ–ª—è—Ö (Goal-Based AI). –°–∏—Å—Ç–µ–º–∞ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –∞–≤—Ç–æ–Ω–æ–º–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ NPC, –≤–∫–ª—é—á–∞—è –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ü–µ–ª–µ–π, –∏—Ö –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∏ —Ä–µ–∞–∫—Ü–∏—é –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ–∫—Ä—É–∂–∞—é—â–µ–π —Å—Ä–µ–¥—ã.

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

```
CurrentGoal (IComponentData)
‚îú‚îÄ‚îÄ GoalType - —Ç–∏–ø —Ç–µ–∫—É—â–µ–π —Ü–µ–ª–∏
‚îú‚îÄ‚îÄ TargetEntity - —Ü–µ–ª–µ–≤–æ–π Entity (–¥–ª—è –∞—Ç–∞–∫, —Å–æ–ø—Ä–æ–≤–æ–∂–¥–µ–Ω–∏—è)
‚îú‚îÄ‚îÄ TargetPosition - —Ü–µ–ª–µ–≤–∞—è –ø–æ–∑–∏—Ü–∏—è –≤ –º–∏—Ä–µ
‚îú‚îÄ‚îÄ ExpiryTime - –≤—Ä–µ–º—è –∏—Å—Ç–µ—á–µ–Ω–∏—è —Ü–µ–ª–∏
‚îî‚îÄ‚îÄ Priority - –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (0.0 - 1.0)
```

### –°–∏—Å—Ç–µ–º—ã (–ø–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è)

```
SimulationSystemGroup
‚îÇ
‚îú‚îÄ‚îÄ 1. GoalPlanningSystem
‚îÇ   ‚îî‚îÄ‚îÄ –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç –∏ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç –Ω–æ–≤—ã–µ —Ü–µ–ª–∏ –¥–ª—è Idle NPC
‚îÇ
‚îú‚îÄ‚îÄ 2. GoalExecutionSystem
‚îÇ   ‚îî‚îÄ‚îÄ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∏—Å—Ç–µ—á–µ–Ω–∏–µ —Ü–µ–ª–µ–π, –æ—á–∏—â–∞–µ—Ç –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
‚îÇ
‚îú‚îÄ‚îÄ 3. Behavioral Systems (–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ)
‚îÇ   ‚îú‚îÄ‚îÄ IdleBehaviorSystem - –ø—Ä–æ—Å—Ç–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ (—Å—Ç–æ—è–Ω–∏–µ, –º–∏–Ω–∏-–¥–≤–∏–∂–µ–Ω–∏—è)
‚îÇ   ‚îú‚îÄ‚îÄ PatrolBehaviorSystem - –ø–∞—Ç—Ä—É–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ SocialBehaviorSystem - —Å–æ—Ü–∏–∞–ª—å–Ω–æ–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ
‚îÇ   ‚îú‚îÄ‚îÄ LifeActivitiesSystem - —Ä–∞–±–æ—Ç–∞, —Å–æ–Ω, –ø—Ä–∏–µ–º –ø–∏—â–∏
‚îÇ   ‚îî‚îÄ‚îÄ CombatBehaviorSystem - –∞—Ç–∞–∫–∞, –±–µ–≥—Å—Ç–≤–æ, –º–µ—Å—Ç—å
‚îÇ
‚îî‚îÄ‚îÄ 4. GoalPathIntegrationSystem
    ‚îî‚îÄ‚îÄ –ò–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ—Ç —Ü–µ–ª–∏ —Å —Å–∏—Å—Ç–µ–º–æ–π pathfinding
```

---

## üéØ –¢–∏–ø—ã —Ü–µ–ª–µ–π (GoalType)

| –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ | –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è |
|-----|----------|--------------|
| **None** | –ù–µ—Ç —Ü–µ–ª–∏ | –ü—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ |
| **Idle** | –û–∂–∏–¥–∞–Ω–∏–µ, —Å—Ç–æ—è–Ω–∏–µ –Ω–∞ –º–µ—Å—Ç–µ | –ë–∞–∑–æ–≤–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ |
| **MoveToLocation** | –î–≤–∏–∂–µ–Ω–∏–µ –∫ —Ç–æ—á–∫–µ | –í—Å–µ NPC |
| **PatrolArea** | –ü–∞—Ç—Ä—É–ª–∏—Ä–æ–≤–∞–Ω–∏–µ | –ü–æ–ª–∏—Ü–∏—è, –±–∞–Ω–¥—ã |
| **Work** | –†–∞–±–æ—Ç–∞ | –ì—Ä–∞–∂–¥–∞–Ω—Å–∫–∏–µ, –ø–æ–ª–∏—Ü–∏—è |
| **Sleep** | –°–æ–Ω | –í—Å–µ NPC (–Ω–æ—á—å) |
| **Eat** | –ü—Ä–∏–µ–º –ø–∏—â–∏ | –í—Å–µ NPC (–æ–±–µ–¥) |
| **Socialize** | –°–æ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è | –í—Å–µ NPC |
| **Flee** | –ë–µ–≥—Å—Ç–≤–æ –æ—Ç —É–≥—Ä–æ–∑—ã | –ü—Ä–∏ –Ω–∏–∑–∫–æ–π —Å–º–µ–ª–æ—Å—Ç–∏ |
| **AttackTarget** | –ê—Ç–∞–∫–∞ —Ü–µ–ª–∏ | –ü—Ä–∏ –≤—ã—Å–æ–∫–æ–π –∞–≥—Ä–µ—Å—Å–∏–∏ |
| **FollowTarget** | –°–ª–µ–¥–æ–≤–∞–Ω–∏–µ –∑–∞ —Ü–µ–ª—å—é | TODO |
| **DefendLocation** | –ó–∞—â–∏—Ç–∞ —Ç–æ—á–∫–∏ | TODO |
| **Investigate** | –†–∞—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ | TODO |
| **Retaliate** | –ú–µ—Å—Ç—å | TODO |
| **VisitLocation** | –ü–æ—Å–µ—â–µ–Ω–∏–µ –ª–æ–∫–∞—Ü–∏–∏ | –í—Å–µ NPC |
| **EscortTarget** | –°–æ–ø—Ä–æ–≤–æ–∂–¥–µ–Ω–∏–µ | TODO |

---

## üß† –õ–æ–≥–∏–∫–∞ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Ü–µ–ª–µ–π

### GoalPlanningSystem

**–ö–æ–Ω—Ç–µ–∫—Å—Ç –∞–Ω–∞–ª–∏–∑–∞:**
- –í—Ä–µ–º—è —Å—É—Ç–æ–∫ (`GameTimeComponent`)
- –§—Ä–∞–∫—Ü–∏—è NPC (`Faction`)
- –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ (`Traits`)
- –¢–µ–∫—É—â–∞—è –ø–æ–∑–∏—Ü–∏—è (`Location`)

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã —Ä–µ—à–µ–Ω–∏–π:**

1. **–°–æ–Ω (Sleep)** - 22:00 - 6:00
   - –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: 0.8 (–≤—ã—Å–æ–∫–∏–π)
   - –ü—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: 1 —á–∞—Å
   - –£—Å–ª–æ–≤–∏–µ: –Ω–æ—á–Ω–æ–µ –≤—Ä–µ–º—è

2. **–†–∞–±–æ—Ç–∞ (Work)** - 8:00 - 18:00
   - –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: 0.6 (—Å—Ä–µ–¥–Ω–∏–π)
   - –ü—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: 2 —á–∞—Å–∞
   - –£—Å–ª–æ–≤–∏–µ: Civilians –∏–ª–∏ Police
   - –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è —Å–ª—É—á–∞–π–Ω–∞—è —Ä–∞–±–æ—á–∞—è –ø–æ–∑–∏—Ü–∏—è (¬±30–º)

3. **–ü–∞—Ç—Ä—É–ª–∏—Ä–æ–≤–∞–Ω–∏–µ (PatrolArea)**
   - –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: 0.5 (—Å—Ä–µ–¥–Ω–∏–π)
   - –ü—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: 10 –º–∏–Ω—É—Ç
   - –£—Å–ª–æ–≤–∏–µ:
     - Police: 50% —à–∞–Ω—Å
     - –ë–∞–Ω–¥—ã: 30% + Aggression * 20%
   - –ì–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è —Å–ª—É—á–∞–π–Ω—ã–µ —Ç–æ—á–∫–∏ (¬±50–º)

4. **–°–æ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è (Socialize)**
   - –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: 0.4
   - –ü—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: 5 –º–∏–Ω—É—Ç
   - –®–∞–Ω—Å: 20%
   - –°–ª—É—á–∞–π–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è (¬±20–º)

5. **–ü–æ—Å–µ—â–µ–Ω–∏–µ –ª–æ–∫–∞—Ü–∏–∏ (VisitLocation)**
   - –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: 0.3
   - –ü—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: 15 –º–∏–Ω—É—Ç
   - –®–∞–Ω—Å: 15%
   - –°–ª—É—á–∞–π–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è (¬±80–º)

6. **Idle (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)**
   - –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: 0.1
   - –ë–µ–∑ –∏—Å—Ç–µ—á–µ–Ω–∏—è

---

## üîß –ü–æ–≤–µ–¥–µ–Ω—á–µ—Å–∫–∏–µ —Å–∏—Å—Ç–µ–º—ã

### 1. IdleBehaviorSystem

**–§—É–Ω–∫—Ü–∏—è:** –ü—Ä–æ—Å—Ç–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –≤ —Ä–µ–∂–∏–º–µ –æ–∂–∏–¥–∞–Ω–∏—è

**–õ–æ–≥–∏–∫–∞:**
- 5% —à–∞–Ω—Å –∫–∞–∂–¥—ã–π –∫–∞–¥—Ä —Å–æ–∑–¥–∞—Ç—å –º–∏–Ω–∏-–¥–≤–∏–∂–µ–Ω–∏–µ
- –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ: –¥–æ 5 –º–µ—Ç—Ä–æ–≤
- –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: 3 —Å–µ–∫—É–Ω–¥—ã
- –ü–µ—Ä–µ—Ö–æ–¥–∏—Ç –≤ `MoveToLocation` –Ω–∞ –∫–æ—Ä–æ—Ç–∫–æ–µ –≤—Ä–µ–º—è

**–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**
```csharp
// NPC —Å—Ç–æ–∏—Ç –Ω–∞ –º–µ—Å—Ç–µ, –∏–Ω–æ–≥–¥–∞ –¥–µ–ª–∞–µ—Ç –Ω–µ–±–æ–ª—å—à–∏–µ —à–∞–≥–∏
// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å–∏—Å—Ç–µ–º–æ–π
```

---

### 2. PatrolBehaviorSystem

**–§—É–Ω–∫—Ü–∏—è:** –ü–∞—Ç—Ä—É–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–∏

**–õ–æ–≥–∏–∫–∞:**
- –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç 3-6 —Ç–æ—á–µ–∫ –º–∞—Ä—à—Ä—É—Ç–∞
- –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É —Ç–æ—á–∫–∞–º–∏: 40–º
- –ü—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ —Ç–æ—á–∫–∏ - –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å–ª–µ–¥—É—é—â—É—é
- –ë–µ—Å–∫–æ–Ω–µ—á–Ω–æ–µ –ø–∞—Ç—Ä—É–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ –∏—Å—Ç–µ—á–µ–Ω–∏—è —Ü–µ–ª–∏

**–ù–∞—Å—Ç—Ä–æ–π–∫–∏:**
```csharp
PATROL_WAYPOINT_DISTANCE = 40f
MIN_PATROL_WAYPOINTS = 3
MAX_PATROL_WAYPOINTS = 6
```

**–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ—Ä–∞–∫—Ü–∏–∏:**
- Police (50% –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è)
- Families, Ballas, Vagos (30% + aggression)

---

### 3. SocialBehaviorSystem

**–§—É–Ω–∫—Ü–∏—è:** –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Ü–∏–∞–ª—å–Ω—ã–º –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ–º

**–õ–æ–≥–∏–∫–∞:**
- NPC –∏–¥–µ—Ç –∫ –º–µ—Å—Ç—É –≤—Å—Ç—Ä–µ—á–∏
- –ü–æ –ø—Ä–∏–±—ã—Ç–∏–∏: —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Ñ–ª–∞–≥ `IsBusy`
- –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: 30 —Å–µ–∫ - 3 –º–∏–Ω—É—Ç—ã
- –ü–æ –æ–∫–æ–Ω—á–∞–Ω–∏–∏: —Å–Ω–∏–º–∞–µ—Ç —Ñ–ª–∞–≥ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ Idle

**TODO (–±—É–¥—É—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è):**
- –ü–æ–∏—Å–∫ –±–ª–∏–∂–∞–π—à–∏—Ö NPC —Ç–æ–π –∂–µ —Ñ—Ä–∞–∫—Ü–∏–∏
- –°–∏—Å—Ç–µ–º–∞ –æ—Ç–Ω–æ—à–µ–Ω–∏–π (Relationships)
- –í–∏–∑—É–∞–ª—å–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã –æ–±—â–µ–Ω–∏—è

---

### 4. LifeActivitiesSystem

**–§—É–Ω–∫—Ü–∏—è:** –û—Å–Ω–æ–≤–Ω—ã–µ –∂–∏–∑–Ω–µ–Ω–Ω—ã–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

**–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º—ã–µ —Ü–µ–ª–∏:**

#### Work (–†–∞–±–æ—Ç–∞)
- –ü—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏: —Ñ–ª–∞–≥ `IsBusy = true`
- –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: –∑–∞–¥–∞–µ—Ç—Å—è –≤ `GoalPlanningSystem`
- –ü–æ –æ–∫–æ–Ω—á–∞–Ω–∏–∏: `IsBusy = false`, –ø–µ—Ä–µ—Ö–æ–¥ –≤ Idle

#### Sleep (–°–æ–Ω)
- –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç: `IsSleeping = true`, `IsBusy = true`
- –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: 1 —á–∞—Å (3600 —Å–µ–∫—É–Ω–¥)
- –ü–æ –ø—Ä–æ–±—É–∂–¥–µ–Ω–∏—é: —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç —Ñ–ª–∞–≥–∏

#### Eat (–ü—Ä–∏–µ–º –ø–∏—â–∏)
- NPC –∏–¥–µ—Ç –∫ –º–µ—Å—Ç—É –ø—Ä–∏–µ–º–∞ –ø–∏—â–∏
- –ü–æ –ø—Ä–∏–±—ã—Ç–∏–∏: `IsBusy = true`
- –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: 10 –º–∏–Ω—É—Ç (600 —Å–µ–∫—É–Ω–¥)
- –ü–æ –æ–∫–æ–Ω—á–∞–Ω–∏–∏: `IsBusy = false`

---

### 5. CombatBehaviorSystem

**–§—É–Ω–∫—Ü–∏—è:** –ë–æ–µ–≤–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ

**–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º—ã–µ —Ü–µ–ª–∏:**

#### AttackTarget
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ —Ü–µ–ª–∏
- –ï—Å–ª–∏ –≤ —Ä–∞–¥–∏—É—Å–µ –∞—Ç–∞–∫–∏ (2–º): –≤—ã–ø–æ–ª–Ω—è–µ—Ç –∞—Ç–∞–∫—É
- –ò–Ω–∞—á–µ: –ø—Ä–µ—Å–ª–µ–¥—É–µ—Ç —Ü–µ–ª—å, –æ–±–Ω–æ–≤–ª—è—è –ø—É—Ç—å

**–ê—Ç–∞–∫–∞:**
```csharp
Damage = Aggression * 10
// TODO: –¢—Ä–µ–±—É–µ—Ç —Å–∏—Å—Ç–µ–º—ã –∑–¥–æ—Ä–æ–≤—å—è
```

#### Flee (–ë–µ–≥—Å—Ç–≤–æ)
- –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ç–æ—á–∫—É –Ω–∞ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–∏ 50–º
- –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: 0.9 (–æ—á–µ–Ω—å –≤—ã—Å–æ–∫–∏–π)
- –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: 1 –º–∏–Ω—É—Ç–∞
- –ü–æ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏: –ø–µ—Ä–µ—Ö–æ–¥ –≤ Idle

**–£—Å–ª–æ–≤–∏—è –±–µ–≥—Å—Ç–≤–∞:**
- –ù–∏–∑–∫–∞—è —Å–º–µ–ª–æ—Å—Ç—å (`Bravery < 0.3`)
- –ü–æ–ª—É—á–µ–Ω–∏–µ —É—Ä–æ–Ω–∞ (TODO)
- –ß–∏—Å–ª–µ–Ω–Ω–æ–µ –ø—Ä–µ–≤–æ—Å—Ö–æ–¥—Å—Ç–≤–æ –≤—Ä–∞–≥–æ–≤ (TODO)

---

## üìä –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –¥—Ä—É–≥–∏–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏

### Pathfinding
```
GoalPlanningSystem ‚Üí CurrentGoal —Å targetPosition
    ‚Üì
GoalPathIntegrationSystem ‚Üí —Å–æ–∑–¥–∞–µ—Ç PathRequest
    ‚Üì
AStarPathfindingSystem ‚Üí –≤—ã—á–∏—Å–ª—è–µ—Ç –ø—É—Ç—å
    ‚Üì
PathFollowingSystem ‚Üí –¥–≤–∏–∂–µ–Ω–∏–µ –ø–æ –ø—É—Ç–∏
    ‚Üì
Behavioral Systems ‚Üí —Ä–µ–∞–∫—Ü–∏—è –Ω–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –ø—É—Ç–∏
```

### StateFlags
```csharp
IsBusy     - —Ä–∞–±–æ—Ç–∞, —Å–æ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è, –ø—Ä–∏–µ–º –ø–∏—â–∏
IsSleeping - —Å–æ–Ω
IsDead     - –±–ª–æ–∫–∏—Ä—É–µ—Ç –≤—Å–µ —Ü–µ–ª–∏
IsArrested - –±–ª–æ–∫–∏—Ä—É–µ—Ç –≤—Å–µ —Ü–µ–ª–∏
```

### Traits (–≤–ª–∏—è–Ω–∏–µ –Ω–∞ –ø–æ–≤–µ–¥–µ–Ω–∏–µ)
```csharp
Aggression  - –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –∞—Ç–∞–∫–∏, —É—Ä–æ–Ω
Bravery     - –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –±–µ–≥—Å—Ç–≤–∞
Anxiety     - –∫–∞—á–µ—Å—Ç–≤–æ —Å–Ω–∞
Intelligence - TODO: —Å–∫–æ—Ä–æ—Å—Ç—å –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
Loyalty     - TODO: –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –ø—Ä–µ–¥–∞—Ç–µ–ª—å—Å—Ç–≤–∞
```

---

## üõ†Ô∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### 1. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–∞–±–æ—Ç–∞
–°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–ª—è –≤—Å–µ—Ö NPC —Å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–º `CurrentGoal`.

### 2. –†—É—á–Ω–æ–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ —Ü–µ–ª–∏
```csharp
var goal = new CurrentGoal(
    GoalType.MoveToLocation,
    targetPosition: new float3(100, 0, 50),
    priority: 0.7f,
    expiryTime: currentTime + 300f // 5 –º–∏–Ω—É—Ç
);
entityManager.SetComponentData(npcEntity, goal);
```

### 3. –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
```csharp
var goal = entityManager.GetComponentData<CurrentGoal>(npcEntity);
if (goal.IsExpired(currentTime))
{
    Debug.Log("Goal expired!");
}
```

---

## üìà –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

**–¶–µ–ª–µ–≤—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏:**
- 1000+ NPC —Å –∞–∫—Ç–∏–≤–Ω—ã–º–∏ —Ü–µ–ª—è–º–∏
- < 0.5ms –Ω–∞ —Å–∏—Å—Ç–µ–º—É –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
- < 1.0ms –Ω–∞ –≤—Å–µ –ø–æ–≤–µ–¥–µ–Ω—á–µ—Å–∫–∏–µ —Å–∏—Å—Ç–µ–º—ã

**–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:**
- Burst compilation –¥–ª—è –≤—Å–µ—Ö —Å–∏—Å—Ç–µ–º
- EntityCommandBuffer –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏–π
- –ü—Ä–æ–≤–µ—Ä–∫–∏ —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–∫—Ç–∏–≤–Ω—ã—Ö NPC (WithNone –¥–ª—è –º–µ—Ä—Ç–≤—ã—Ö)

---

## üîÆ Roadmap

### –§–∞–∑–∞ 1 (–¢–µ–∫—É—â–∞—è) ‚úÖ
- ‚úÖ –ë–∞–∑–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ü–µ–ª–µ–π
- ‚úÖ –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤—Ä–µ–º–µ–Ω–∏
- ‚úÖ 5 –ø–æ–≤–µ–¥–µ–Ω—á–µ—Å–∫–∏—Ö —Å–∏—Å—Ç–µ–º
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å pathfinding

### –§–∞–∑–∞ 2 (–í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ)
- ‚è≥ –°–∏—Å—Ç–µ–º–∞ –∑–¥–æ—Ä–æ–≤—å—è –∏ —É—Ä–æ–Ω–∞
- ‚è≥ –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –æ—Ç–Ω–æ—à–µ–Ω–∏–π
- ‚è≥ Investigate –∏ Retaliate —Ü–µ–ª–∏
- ‚è≥ –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è (Schedule)

### –§–∞–∑–∞ 3 (–ü–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è)
- üîú –ò–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–æ–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ (HTN)
- üîú –ì—Ä—É–ø–ø–æ–≤–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ (—Ñ–æ—Ä–º–∞—Ü–∏–∏)
- üîú –≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞
- üîú –ü–∞–º—è—Ç—å –æ —Å–æ–±—ã—Ç–∏—è—Ö
- üîú –°–ª–æ–∂–Ω—ã–µ —Å–æ—Ü–∏–∞–ª—å–Ω—ã–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è

---

## üêõ –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

1. **AttackTarget –Ω–µ –Ω–∞–Ω–æ—Å–∏—Ç —Ä–µ–∞–ª—å–Ω—ã–π —É—Ä–æ–Ω**
   - –¢—Ä–µ–±—É–µ—Ç: –°–∏—Å—Ç–µ–º–∞ –∑–¥–æ—Ä–æ–≤—å—è (Health component)
   - Workaround: –ü–æ–∫–∞ —Ç–æ–ª—å–∫–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

2. **–°–æ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –Ω–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç –æ—Ç–Ω–æ—à–µ–Ω–∏—è**
   - –¢—Ä–µ–±—É–µ—Ç: Relationships —Å–∏—Å—Ç–µ–º–∞
   - Workaround: –ü–æ–∫–∞ —Å–ª—É—á–∞–π–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏

3. **–ü–∞—Ç—Ä—É–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ –ø—Ä–∏–≤—è–∑–∞–Ω–æ –∫ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–∏**
   - –¢—Ä–µ–±—É–µ—Ç: –°–∏—Å—Ç–µ–º–∞ –∑–æ–Ω (Territory)
   - Workaround: –°–ª—É—á–∞–π–Ω—ã–µ —Ç–æ—á–∫–∏ –≤ —Ä–∞–¥–∏—É—Å–µ

4. **–ù–µ—Ç –ø—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏–∏ —Ü–µ–ª–µ–π**
   - –¢—Ä–µ–±—É–µ—Ç: Goal stack –∏–ª–∏ priority queue
   - Workaround: –û–¥–Ω–∞ —Ü–µ–ª—å –∑–∞ —Ä–∞–∑

---

## üí° –°–æ–≤–µ—Ç—ã –ø–æ –æ—Ç–ª–∞–¥–∫–µ

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ü–µ–ª–µ–π
```csharp
// –í—Å–µ —Å–∏—Å—Ç–µ–º—ã –ª–æ–≥–∏—Ä—É—é—Ç –∫–ª—é—á–µ–≤—ã–µ —Å–æ–±—ã—Ç–∏—è
// –§–∏–ª—å—Ç—Ä—É–π—Ç–µ –ø–æ —Ü–≤–µ—Ç—É –≤ Unity Console:
// <color=cyan>    - Planning
// <color=yellow>  - Execution
// <color=red>     - Combat
// <color=magenta> - Social
// <color=blue>    - Work
// <color=purple>  - Sleep
```

### ViceDebugWindow
–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤–∫–ª–∞–¥–∫—É "NPCs" –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞:
- –¢–µ–∫—É—â–∞—è —Ü–µ–ª—å –∫–∞–∂–¥–æ–≥–æ NPC
- –°—Ç–∞—Ç—É—Å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- –§–ª–∞–≥–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è

### Scene –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è
```csharp
// PathVisualizer –ø–æ–∫–∞–∂–µ—Ç —Ç–µ–∫—É—â–∏–π –ø—É—Ç—å NPC
// NavigationGridVisualizer –ø–æ–∫–∞–∂–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –∫–ª–µ—Ç–æ–∫
```

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

### –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
- `CurrentGoal.cs` - –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Ü–µ–ª–∏
- `GoalPathIntegrationSystem.cs` - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å pathfinding
- `StateFlags.cs` - —Ñ–ª–∞–≥–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è
- `Traits.cs` - —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –ª–∏—á–Ω–æ—Å—Ç–∏

### –í–Ω–µ—à–Ω–∏–µ —Å—Å—ã–ª–∫–∏
- [Goal-Oriented Action Planning (GOAP)](https://alumni.media.mit.edu/~jorkin/goap.html)
- [Unity DOTS Best Practices](https://docs.unity3d.com/Packages/com.unity.entities@latest)

---

**–í–µ—Ä—Å–∏—è:** 1.0  
**–ê–≤—Ç–æ—Ä:** PROJECT-VICE Team  
**–î–∞—Ç–∞:** 2025

---
